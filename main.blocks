<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="4)(fuReP2U*F$_VJsYa@">mode</variable><variable id="$#-]a5!Zn~t/eIYahe_}">deg_0</variable><variable id="kJtAy3.a~0]$n.O^-`Ex">deg_180</variable><variable id="j4Zg`y-.ji$,L.B`MVP`">bf</variable><variable id="YjNo8-RaK/2*lz?(S)Nw">m_deg</variable><variable id="04+*S=E?],hCVSM!smF7">string_bf</variable></variables><comment id="s[?J5qtN?bTmoQj:pT:F" data="0" x="0" y="0" h="120" w="160">0゜の位置のアナログ値を入れる</comment><comment id="VxQjIu2w$*?(@~*GKEk+" data="1" x="0" y="0" h="120" w="170">180゜の位置のアナログ値を入れる</comment><comment id="}yOZ+7l!+r~8EQ_Is2yv" data="2" x="0" y="0" h="120" w="160">使い捨てのバッファー</comment><block type="pxt-on-start" id="q(WLQFYJ`C_R;i2]:ye`" x="20" y="20"><statement name="HANDLER"><block type="OLED12864_I2C_init" id="2bIUj6bALj.T4*#~QM(;"><comment pinned="false" h="80" w="160">最初に実行する</comment><value name="addr"><shadow type="math_number" id="L[V%5.?-Gr2(4as_PO)v"><field name="NUM">60</field></shadow></value><next><block type="OLED12864_I2C_SHOWSTRING" id="fF*:vwJA`M4ONQ}wm2jJ"><value name="x"><shadow type="math_number" id="-saBUrNkG?tkASrzh:Fq"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="PsL}aH:lHRpfJjV}%61r"><field name="NUM">0</field></shadow></value><value name="s"><shadow type="text" id="xf{Q;|[gPmd3z`D##)`m"><field name="TEXT">ROM 3-63</field></shadow></value><value name="color"><shadow type="math_number" id="2MA;WDDYd9F}2)!k0=b`"><field name="NUM">1</field></shadow></value><next><block type="device_pause" id="wJAQVwHo1i}%(1r;:QCE"><value name="pause"><shadow type="timePicker" id="do07PWU:.mP#ak2U(ODt"><field name="ms">3000</field></shadow></value><next><block type="variables_set" id="|[wArW[[aRQ##lIx4X]D"><field name="VAR" id="4)(fuReP2U*F$_VJsYa@">mode</field><comment pinned="false" h="80" w="160">角度の測定値を入れる</comment><value name="VALUE"><shadow type="math_number" id="%Ik$;8~S!YPgVTOXk7Xn"><field name="NUM">999</field></shadow></value><next><block type="device_set_pull" id="sxI700{)Gn=q!ln!2O(L"><field name="pin">DigitalPin.P1</field><field name="pull">PinPullMode.PullDown</field><comment pinned="false" h="80" w="160">測定過程を入れる(999:準備状態 1:測定中 0:停止)</comment><next><block type="function_call" id="#y|:[_H=dj}XJz.[L{tc"><mutation name="syokika" functionid="r:/Pl-4w-~C-HhX|aY#s"></mutation><comment pinned="false" h="80" w="160">タクトスイッチの入力を安定化させる</comment></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="device_button_event" id="[2CBRwL$,*wvTC~o!yy(" x="422" y="20"><field name="NAME">Button.AB</field><statement name="HANDLER"><block type="function_call" id="[KS4[hS7r]9.XWG23,N("><mutation name="syokika" functionid="r:/Pl-4w-~C-HhX|aY#s"></mutation><comment pinned="false" h="80" w="160">A+Bボタンでキャリブレーション呼び出し</comment></block></statement></block><block type="device_button_event" id="}R%P1U~vn$[uv|E+14Pm" x="731" y="20"><field name="NAME">Button.A</field><comment pinned="false" h="80" w="160">電気角度計　ROM3</comment><statement name="HANDLER"><block type="variables_set" id="3x%I9^nS68@u]j/FwZTU"><field name="VAR" id="4)(fuReP2U*F$_VJsYa@">mode</field><comment pinned="false" h="80" w="160">Aボタンで測定開始</comment><value name="VALUE"><shadow type="math_number" id="jL,?yKlQ1]=8yHS`u:e6"><field name="NUM">1</field></shadow></value><next><block type="OLED12864_I2C_CLEAR" id="{pRXj*#Kj3d^y~rCfYV2"><next><block type="OLED12864_I2C_SHOWSTRING" id="_6UJ51Xvyg}r}tB;_@hP"><value name="x"><shadow type="math_number" id="e++ovAw}krMkPjjkY1}n"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="Um:_Klll}+7ZB-`NjE=6"><field name="NUM">0</field></shadow></value><value name="s"><shadow type="text" id="$hQgc)tZd.57z*J,pV8_"><field name="TEXT">Start Position.</field></shadow></value><value name="color"><shadow type="math_number" id="vpB$f7vopO9fyS/N[89m"><field name="NUM">1</field></shadow></value><next><block type="function_call" id="v{z;W`C+@;{x[ar]#JB,"><mutation name="get_start_position" functionid=";f{o0XMt5cE8QNK0s]A8"></mutation></block></next></block></next></block></next></block></statement></block><block type="device_forever" id="O2o0h-,$6sA18W{pBpKl" x="1086" y="20"><comment pinned="false" h="80" w="160">キャリブレーション呼び出し
測定ルーチン
測定停止</comment><statement name="HANDLER"><block type="typescript_statement" id="VtVru=YX;CwS~$)s~HY4" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let string_bf: string;" numlines="1" declaredvars="string_bf"></mutation><next><block type="controls_if" id="sQNK9WUTspbQY+1+nxng"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="eX3Xg%hFX#5MRP;bettf"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="9N!A#F{n[gqa4ky68+0*"><field name="VAR" id="4)(fuReP2U*F$_VJsYa@">mode</field></block></value><value name="B"><shadow type="math_number" id=":H!TgQd,:n5,GRw.26%9"><field name="NUM">1</field></shadow></value></block></value><statement name="DO0"><block type="basic_show_icon" id="P(k,;1Fufd:/iXdN^?3="><field name="i">IconNames.Heart</field><comment pinned="false" h="80" w="160">測定中</comment><next><block type="device_while" id="R1H)y)K+mM$WDb9U,+|Z"><comment pinned="false" h="80" w="160">タクトスイッチが押されるまで待つ</comment><value name="COND"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="t1sxFFs4;+Ze$D|Tm2Pg"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_digital_pin" id="KEMO@o:%6/Rc/1cBT7^^"><field name="name">DigitalPin.P1</field></block></value><value name="B"><shadow type="math_number" id="ROHVoJ|AX~DqvwD(KK}$"><field name="NUM">0</field></shadow></value></block></value><next><block type="variables_set" id="WXh,7MR(iTk=s.#Ws[s6"><field name="VAR" id="j4Zg`y-.ji$,L.B`MVP`">bf</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_analog_pin" id="T|w*l@lRu5})8e=O|Eg["><field name="name">AnalogPin.P0</field></block></value><next><block type="variables_set" id="rhw{4[{9VuQ9Q;=5N,#M"><field name="VAR" id="YjNo8-RaK/2*lz?(S)Nw">m_deg</field><comment pinned="false" h="80" w="160">可変抵抗の電圧を取得
取得したアナログ値をキャリブレーション値で角度に変換</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_map" id="ZRqEx1k(Ah?8?8t%A^Af"><value name="value"><block type="variables_get" id="G3**:m`x@QH}9)YwDErQ"><field name="VAR" id="j4Zg`y-.ji$,L.B`MVP`">bf</field></block></value><value name="fromLow"><block type="variables_get" id=";t}YJnw{.IdPK]!;G0#0"><field name="VAR" id="$#-]a5!Zn~t/eIYahe_}">deg_0</field></block></value><value name="fromHigh"><block type="variables_get" id="]?Y}1.~KxY=ATNA{B8aQ"><field name="VAR" id="kJtAy3.a~0]$n.O^-`Ex">deg_180</field></block></value><value name="toLow"><shadow type="math_number" id="E#6Bx{MQ4k1JZ#HB)*s+"><field name="NUM">0</field></shadow></value><value name="toHigh"><shadow type="math_number" id="2Af~O3pC[NO.{+g^?.4z"><field name="NUM">180</field></shadow></value></block></value><next><block type="music_playable_play" id="8N+AiOJn%yn2W36xvbiV"><field name="playbackMode">music.PlaybackMode.UntilDone</field><value name="toPlay"><shadow type="music_string_playable"></shadow><block type="music_tone_playable" id="[~v#+Na.e|PtE`c}X$fC"><value name="note"><shadow type="device_note" id="1dY=fZ49#k)2EwC`sG]{"><field name="name">262</field></shadow></value><value name="duration"><shadow type="device_beat" id="[N-NAYhqb,C`NAlONqyP"><field name="fraction">BeatFraction.Whole</field></shadow></value></block></value><next><block type="variables_set" id="T|6*Qb4Fpp#:NcxKAaU4"><field name="VAR" id="j4Zg`y-.ji$,L.B`MVP`">bf</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_js_round" id="L{dGhu`OB_6ag=`tljNi"><field name="OP">round</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="{sq9KK+QXXNK8Xf|nG?a"><field name="VAR" id="YjNo8-RaK/2*lz?(S)Nw">m_deg</field></block></value></block></value><next><block type="variables_set" id="G|l=c4v|wq:yTG3@AzXM"><field name="VAR" id="04+*S=E?],hCVSM!smF7">string_bf</field><comment pinned="false" h="80" w="160">角度を四捨五入</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="text_join" id="i.V`dp.U9!1YP2pq()r$"><mutation items="2"></mutation><value name="ADD0"><shadow type="text"><field name="TEXT"></field></shadow><block type="text_join" id="Nzo+8~k1fb;?6[A7k*76"><mutation items="1"></mutation><value name="ADD0"><shadow type="text"><field name="TEXT"></field></shadow><block type="variables_get" id="D_N*gO5XqqQu[/-!Fjf."><field name="VAR" id="j4Zg`y-.ji$,L.B`MVP`">bf</field></block></value></block></value><value name="ADD1"><shadow type="text" id="P#=Y#XL%MMHc7C|.knpu"><field name="TEXT"> deg</field></shadow></value></block></value><next><block type="OLED12864_I2C_CLEAR" id="6`V7nV~]t^:}D@S-b#_*"><next><block type="OLED12864_I2C_SHOWSTRING" id="66EKWU/ca5YB,)].vkq_"><value name="x"><shadow type="math_number" id="9JCgj~3?(i[NCY3R:*O3"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="%Uv/H)=AI-Iujs/1?[Hh"><field name="NUM">0</field></shadow></value><value name="s"><block type="variables_get" id="U4cxDiJ:FcS}`/!Z:X^*"><field name="VAR" id="04+*S=E?],hCVSM!smF7">string_bf</field></block></value><value name="color"><shadow type="math_number" id="ux)[VE.I[Z4wD$V`?(:E"><field name="NUM">1</field></shadow></value><next><block type="OLED12864_I2C_SHOWSTRING" id="}2ynl2me+0N??aD]Vi|u"><value name="x"><shadow type="math_number" id="2Y`H6MgsL|6v:*W@I}}4"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="Q2R6/h!@i0S%a`UliohI"><field name="NUM">2</field></shadow></value><value name="s"><shadow type="text" id="{R5a@)gtF=jo}gpVRGS0"><field name="TEXT">measur-&gt;A</field></shadow></value><value name="color"><shadow type="math_number" id="PtwU7-q^lC#ifMj[ltJw"><field name="NUM">1</field></shadow></value><next><block type="variables_set" id="1uwbQ$+_~T6f@RKl;9)a"><field name="VAR" id="4)(fuReP2U*F$_VJsYa@">mode</field><value name="VALUE"><shadow type="math_number" id="HndZvEBiazAy!@WE]5n1"><field name="NUM">0</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></next></block></statement></block><block type="function_definition" id="s?0l@[oP|_vXM9i@)O(}" x="2642" y="20"><mutation name="syokika" functionid="r:/Pl-4w-~C-HhX|aY#s"></mutation><field name="function_name">syokika</field><statement name="STACK"><block type="OLED12864_I2C_CLEAR" id="ewgV8]=(Ta8JB#lr9k~m"><comment pinned="false" h="80" w="160">キャリブレーション</comment><next><block type="OLED12864_I2C_SHOWSTRING" id="SBVZ!IB=(n|BY=JhoB[W"><value name="x"><shadow type="math_number" id="V/U!}cok?H1IXBm^(m?i"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="a(6]Id[]5TRDIWjr[FlQ"><field name="NUM">0</field></shadow></value><value name="s"><shadow type="text" id="tc52PN^HD||SI%(*Tw[("><field name="TEXT">Start Cal</field></shadow></value><value name="color"><shadow type="math_number" id="K%q(^,57d=7zNU~a7;-7"><field name="NUM">1</field></shadow></value><next><block type="OLED12864_I2C_SHOWSTRING" id="asz{.,:[mBYpFQrkX?5="><value name="x"><shadow type="math_number" id=")gx}P|yVsrKo8fz_jp1Z"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="*1(mUo6O#r]RVf3`_!3H"><field name="NUM">1</field></shadow></value><value name="s"><shadow type="text" id="-(bq#ml1-}?-#Wir7xF-"><field name="TEXT">move to 0</field></shadow></value><value name="color"><shadow type="math_number" id="{=,JA}i23m/(VvSF|Y#*"><field name="NUM">1</field></shadow></value><next><block type="music_playable_play" id="Yf7_b?8|eqlnL}f,oiDI"><field name="playbackMode">music.PlaybackMode.UntilDone</field><value name="toPlay"><shadow type="music_string_playable"></shadow><block type="music_tone_playable" id=";C,MFH,2[Ltup?Yi:].$"><value name="note"><shadow type="device_note" id="PT(Tr]1,R!f)Iu@Qo3oe"><field name="name">262</field></shadow></value><value name="duration"><shadow type="device_beat" id="7o8KJ:nN!FHBK=f*hEQ%"><field name="fraction">BeatFraction.Whole</field></shadow></value></block></value><next><block type="device_while" id="tAPC@#!TsI.(4,K)H4`$"><value name="COND"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="qynv8$*gYOAK*}P;I3a1"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_digital_pin" id="$6~cCb3?AO1_yDjU2iX@"><field name="name">DigitalPin.P1</field></block></value><value name="B"><shadow type="math_number" id="Rv4U~-f!..Z(n{w_]G1K"><field name="NUM">0</field></shadow></value></block></value><next><block type="variables_set" id="c2qG9IicTpUDCGdIOQc,"><field name="VAR" id="$#-]a5!Zn~t/eIYahe_}">deg_0</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_analog_pin" id="dgmE0[x=Tc)n^m2D/A]}"><field name="name">AnalogPin.P0</field></block></value><next><block type="OLED12864_I2C_SHOWSTRING" id="WUh.WLJ1O_rO7ae-q`ww"><value name="x"><shadow type="math_number" id="-J}x;H`)8.Lj7cE;|BxU"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="vJ$BGtxr?b-I?H$;+A,G"><field name="NUM">1</field></shadow></value><value name="s"><shadow type="text" id="aC@*rZYR?h)ejExuQ8Qn"><field name="TEXT">move to 180</field></shadow></value><value name="color"><shadow type="math_number" id="rhlo@oUf[3lEL{J9[hBU"><field name="NUM">1</field></shadow></value><next><block type="music_playable_play" id="G~9FvF|y/F-u~~FZpFHC"><field name="playbackMode">music.PlaybackMode.UntilDone</field><value name="toPlay"><shadow type="music_string_playable"></shadow><block type="music_tone_playable" id=";rPbS2!1#APp:ha6R?x)"><value name="note"><shadow type="device_note" id="cw[nnE[KZt{YL7WeRzOI"><field name="name">262</field></shadow></value><value name="duration"><shadow type="device_beat" id="x/e:IA8eo?GdpW]9Aa=O"><field name="fraction">BeatFraction.Whole</field></shadow></value></block></value><next><block type="device_while" id="N`mD[HpDaK7dKksgaiy1"><value name="COND"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="$xV}uERv=9IxE.NZX`li"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_digital_pin" id="8u[i_uH[U^4d+e3wa.f2"><field name="name">DigitalPin.P1</field></block></value><value name="B"><shadow type="math_number" id="4?(;U;^WhF/ZyxC1sybi"><field name="NUM">0</field></shadow></value></block></value><next><block type="variables_set" id="dx[dB%^:_dIwVrSc-mQB"><field name="VAR" id="kJtAy3.a~0]$n.O^-`Ex">deg_180</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_get_analog_pin" id="W,=Ld*dUnO]$Bv-eT-PS"><field name="name">AnalogPin.P0</field></block></value><next><block type="music_playable_play" id="`=*o1t7j=ZYEDrGS{?:,"><field name="playbackMode">music.PlaybackMode.UntilDone</field><value name="toPlay"><shadow type="music_string_playable"></shadow><block type="music_tone_playable" id="~xF[60]^YhqT5c{~h9b("><value name="note"><shadow type="device_note" id="@.rJIZd77lI!c0Sq7TgS"><field name="name">262</field></shadow></value><value name="duration"><shadow type="device_beat" id="~G}[rNh];nF6Tg)e7rp+"><field name="fraction">BeatFraction.Whole</field></shadow></value></block></value><next><block type="variables_set" id="dEmUW,cTMbSdqIVm9g^X"><field name="VAR" id="4)(fuReP2U*F$_VJsYa@">mode</field><value name="VALUE"><shadow type="math_number" id="TW9R|wKc,wersBI-VKQq"><field name="NUM">0</field></shadow></value><next><block type="basic_show_icon" id="se=jxh9/9sb{#~OyBK~i"><field name="i">IconNames.Yes</field><next><block type="OLED12864_I2C_SHOWSTRING" id="P80bbI0ezN@IOT[_EE.L"><value name="x"><shadow type="math_number" id=":26[x!Sxt=fEgDjcFV]t"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id=";byo^~5/.8KYTiEl6air"><field name="NUM">2</field></shadow></value><value name="s"><shadow type="text" id="ENq[9k,!dG$]%pv]lc73"><field name="TEXT">END Cal</field></shadow></value><value name="color"><shadow type="math_number" id="H(C_K6gTmo=TnY,.vqK^"><field name="NUM">1</field></shadow></value><next><block type="device_pause" id="{0I@#kFK9~H)gYxNzN;L"><value name="pause"><shadow type="timePicker" id="^btqv^0yC1jrpY?8Nr75"><field name="ms">1000</field></shadow></value><next><block type="OLED12864_I2C_CLEAR" id="Ms#ZKC+4?yZW{F1{Mzsn"><next><block type="OLED12864_I2C_SHOWSTRING" id="OFEj(jwWn4o3d}qNiqiW"><value name="x"><shadow type="math_number" id="PNlZj@krC,jS:/nD$EIP"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="Jt/(z$wwVh?JuDsB`D1s"><field name="NUM">0</field></shadow></value><value name="s"><shadow type="text" id="zKQFLmp)#XgE@!3lP%P1"><field name="TEXT">Measurement  Ready</field></shadow></value><value name="color"><shadow type="math_number" id="5UL3Z48pP-F)b5ye~wxx"><field name="NUM">1</field></shadow></value><next><block type="OLED12864_I2C_SHOWSTRING" id="Ov8z#XC{DX$`+J)fe9qe"><value name="x"><shadow type="math_number" id="Ww~%.U|Wm,G$^CC1Z6ZP"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="ki(B,Bs2kEpdn@%EJf5b"><field name="NUM">2</field></shadow></value><value name="s"><shadow type="text" id="t7H/Tc4FJ6TGIHE;do:f"><field name="TEXT">Start-&gt;A</field></shadow></value><value name="color"><shadow type="math_number" id="LtOLXhw:;JzyimjR=4]8"><field name="NUM">1</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="Ix,EP2w9Nk]8R`{|}sG?" x="48" y="1180"><mutation name="get_start_position" functionid=";f{o0XMt5cE8QNK0s]A8"></mutation><field name="function_name">get_start_position</field><comment pinned="false" h="80" w="160">global bf, m_deg, mode, start_deg
OLED12864_I2C.clear()
OLED12864_I2C.show_string(0, 1, "move to St.", 1)
basic.show_icon(IconNames.ASLEEP)
タクトスイッチが押されるまで待つ
while pins.digital_read_pin(DigitalPin.P1) == 0:
pass
bf = pins.analog_read_pin(AnalogPin.P0) #可変抵抗の電圧を取得
#取得したアナログ値をキャリブレーション値で角度に変換
m_deg = Math.map(bf, deg_0, deg_180, 0, 180)
music.play(music.tone_playable(262, music.beat(BeatFraction.WHOLE)),
music.PlaybackMode.UNTIL_DONE)
bf=Math.round(m_deg) #角度を四捨五入
string_bf=bf+" deg"
OLED12864_I2C.clear()
OLED12864_I2C.show_string(0, 0,'Start deg', 1)
OLED12864_I2C.show_string(0, 1,string_bf, 1)
start_deg=bf</comment><data>0;1;2</data><statement name="STACK"><block type="OLED12864_I2C_CLEAR" id="fBpfbeEf6[cUEa.l:2__"><next><block type="OLED12864_I2C_SHOWSTRING" id="P:UAL7//`{@?k+:5[Lla"><value name="x"><shadow type="math_number" id="P]/8U}XieL3ML1o]NFd~"><field name="NUM">0</field></shadow></value><value name="y"><shadow type="math_number" id="#m=xXn]zD3/vF1=X-AP5"><field name="NUM">0</field></shadow></value><value name="s"><shadow type="text" id="ehrsD[81(^FPe(f;wsFo"><field name="TEXT">Hello!</field></shadow></value><value name="color"><shadow type="math_number" id="B(AKa6eUgd/ilP={-3?F"><field name="NUM">1</field></shadow></value></block></next></block></statement></block></xml>